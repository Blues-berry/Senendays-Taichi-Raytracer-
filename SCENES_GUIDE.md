# 场景配置完整指南 (Scene Configuration Guide)

本文档提供项目中所有场景的完整说明和使用方法。

---

## 场景概览

| 场景名称 | 描述 | 主要测试 | 推荐用途 |
|---------|------|---------|---------|
| `random` | 随机小球场景 | 基础渲染 | 默认场景 |
| `cornell_box` | 标准 Cornell Box | 颜色溢出、间接光 | 经典测试 |
| `two_room` | 两室一门 | 窄缝漏光 | 复杂遮挡 |
| `night_scene` | 夜间场景 | 多光源、高反射 | 光照复杂度 |
| `classroom` | 教室场景 | 环境光、间接光 | 室内场景 |
| `bathroom` | 浴室场景 | 镜面、caustics | 高反射 |
| `veach_mis` | Veach MIS | 重要性采样 | 采样效率 |

---

## 场景详细说明

### 1. Random Scene (random) - 随机小球场景

#### 场景描述
经典的随机小球场景，源自 "Ray Tracing in One Weekend"。

#### 场景元素
- **地面**: 大平面，灰色材质
- **小球网格**: 400+ 个随机材质小球
  - 80% 漫反射（随机颜色）
  - 15% 金属（高反射）
  - 5% 玻璃（折射）
- **三个大球**:
  - 中心玻璃球（折射率 1.5）
  - 左侧漫反射球（棕色）
  - 右侧金属球（铜色）
- **光源**: 顶部单一点光源

#### 材质组合
- 漫反射: 小球、大球、地面
- 金属: 高反射、不同粗糙度
- 玻璃: 折射

#### 相机参数
- 视点: (13, 2, 3)
- 目标: (0, 0, 0)
- FOV: 20°
- 景深: 0.6（带散焦）

#### 预期效果
- 色彩丰富的漫反射
- 清晰的玻璃折射
- 金属镜面反射
- 景深效果

---

### 2. Cornell Box (cornell_box) - 标准 Cornell Box

#### 场景描述
学术界标准测试场景，用于验证颜色溢出和间接光照。

#### 场景元素
- **五面墙**:
  - 左墙: 红色 (0.65, 0.05, 0.05)
  - 右墙: 绿色 (0.12, 0.45, 0.15)
  - 地面/天花板/后墙: 白色 (0.73, 0.73, 0.73)
- **顶部面光源**: 强发光面（模拟天花板灯）
- **盒内两球**:
  - 左侧: 高反射金属球（fuzz=0.01）
  - 右侧: 折射玻璃球（折射率 1.5）

#### 材质组合
- 漫反射: 墙壁
- 金属: 低模糊度，镜面反射
- 玻璃: 折射
- 发光: 面光源

#### 相机参数
- 视点: (0, 0, 8.5) - 盒外
- 目标: (0, -0.2, -1.3) - 盒内
- FOV: 40°
- 景深: 禁用

#### 预期效果
- 红绿颜色溢出到对面墙壁
- 间接光照照亮阴影区域
- 金属反射清晰，玻璃折射准确

---

### 3. Two Room (two_room) - 两室一门

#### 场景描述
两个房间通过一个门缝连接，用于测试窄缝漏光和深度遮挡检测。

#### 场景元素
- **房间A** (z < 0): 包含光源
  - 墙壁: 左红、右绿
  - 光源: 天花板强光
  - 小球: 金属材质
- **房间B** (z > 0): 仅通过门缝接受间接光
  - 墙壁: 相同材质
  - 小球: 不同金属色（用于观察间接光效果）
- **门**: 前墙开缝

#### 材质组合
- 漫反射: 墙壁
- 金属: 小球

#### 相机参数
- 视点: (-room_width/2, room_height/2, room_depth + 2) - 房间B内
- 目标: (-room_width/2, room_height/2, -room_depth/2) - 房间A
- FOV: 60°

#### 预期效果
- 房间A明亮
- 房间B通过门缝接受微弱间接光
- 测试深度遮挡是否阻止光线"穿墙"

---

### 4. Night Scene (night_scene) - 夜间场景

#### 场景描述
黑色背景下的多色高亮度点光源，搭配高反射金属球。

#### 场景元素
- **地面**: 深色 (0.08, 0.08, 0.09)
- **5个彩色点光源**:
  1. 暖橘色 (15, 9, 4)
  2. 冰蓝色 (4, 10, 15)
  3. 洋红色 (14, 4, 10)
  4. 绿色 (6, 15, 6)
  5. 冷白偏蓝 (12, 12, 16)
- **25个高反射金属球**: 随机分布，低模糊度

#### 材质组合
- 高反射金属: 所有小球
- 发光: 5个点光源
- 暗色漫反射: 地面

#### 相机参数
- 视点: (0, 3, 12)
- 目标: (0, 1, 0)
- FOV: 35°
- 景深: 禁用

#### 预期效果
- 多彩高对比度
- 高反射小球反射多个光源
- 暗背景衬托光源效果

---

### 5. Classroom (classroom) - 教室场景

#### 场景描述
黑板 + 窗户光（环境光主导），测试环境光照和间接光传播。

#### 场景元素
- **墙壁**: 白瓷砖 (0.85, 0.85, 0.85)
- **黑板**: 深色大球 (0.05, 0.05, 0.08)
- **窗户**: 2个蓝色发光大球（模拟窗外天空光）
- **讲台**: 木质材质
- **课桌**: 两排木纹课桌
- **天花板灯**: 辅助光源

#### 材质组合
- 漫反射: 白墙、木地板、课桌、黑板
- 发光: 窗户（蓝色）、天花板灯（白色）
- 金属: 讲台、装饰球
- 玻璃: 讲台装饰物

#### 相机参数
- 视点: (0, room_height/2 + 0.5, room_depth + 2) - 后方
- 目标: (0, room_height/2, 0) - 前方
- FOV: 55°

#### 预期效果
- 主光源来自窗外（蓝色天空光）
- 黑板反射部分环境光
- 课桌下方有间接光照
- 整体色调偏冷（窗户光）

---

### 6. Bathroom (bathroom) - 浴室场景

#### 场景描述
白瓷砖 + 镜面/玻璃（高反射 + caustics），测试镜面反射和焦散。

#### 场景元素
- **墙壁**: 白瓷砖 (0.92, 0.92, 0.95)
- **洗手台**: 木质材质 (0.6, 0.5, 0.4)
- **镜子**: 高反射金属球（fuzz=0.0）
- **浴缸**: 玻璃材质（折射率 1.5）
- **水面**: 透明球（折射率 1.33）
- **玻璃杯**: 小玻璃球
- **镜面球**: 小金属球（fuzz=0.0）
- **光源**:
  - 顶部: 暖色灯光 (1.0, 0.9, 0.75)
  - 镜子前: 辅助灯光

#### 材质组合
- 高反射: 镜子（fuzz=0.0）、镜面球
- 玻璃: 浴缸、玻璃杯
- 水: 折射率 1.33
- 发光: 暖色灯光
- 漫反射: 墙壁、洗手台

#### 相机参数
- 视点: (0, room_height/2, -room_depth/2 + 0.5) - 门口
- 目标: (0, room_height/2, room_depth/2) - 镜子
- FOV: 60°

#### 预期效果
- 镜子清晰反射场景
- 玻璃和水产生折射
- 可能出现焦散（caustics）
- 暖色调（室内灯光）

---

### 7. Veach MIS (veach_mis) - Veach MIS 场景

#### 场景描述
多强度光源，测试重要性采样（MIS）效果。

#### 场景元素
- **基础房间**: 六面白墙
- **多强度光源**: 3组光源，强度分别为 1.0, 10.0, 100.0
  - 每组包含顶部和底部两个小灯
- **高反射区域**（左侧）:
  - 镜面地板（fuzz=0.0）
  - 玻璃球（折射率 1.5）
- **低反射区域**（右侧）:
  - 深色漫反射地板
  - 漫反射球
- **中间区域**:
  - 3个玻璃球
  - 3个金属球（不同粗糙度: 0.0, 0.1, 0.2）
- **观察球**: 3个白色球（评估光照分布）
- **辅助光源**: 中心大灯

#### 材质组合
- 高反射金属: 镜面地板、镜面球
- 漫反射: 墙壁、观察球、低反射区域
- 玻璃: 玻璃球
- 金属: 不同粗糙度
- 发光: 多强度光源

#### 相机参数
- 视点: (0, 2.5, -3) - 前方
- 目标: (0, 2.5, 0) - 多光源区域
- FOV: 50°

#### 预期效果
- 同一区域光照平滑混合不同强度光源
- 重要性采样平衡光源采样和 BSDF 采样
- 高反射和低反射区域展示不同光照特性

---

## 使用方法

### 切换场景

#### 方法1: 修改 main.py
```python
# 在 main.py 顶部修改
CURRENT_SCENE = 'classroom'  # 替换为任意场景名称
```

#### 方法2: 命令行（需扩展）
```bash
# 如需命令行支持，可在 main.py 添加：
# import sys
# if len(sys.argv) > 1:
#     CURRENT_SCENE = sys.argv[1]
# python main.py classroom
```

#### 方法3: 修改 benchmark.py
```python
# 在 benchmark.py 中修改场景参数
run_group_experiments('classroom')  # 或任意场景名称
```

### 快速测试所有场景

使用提供的快速测试脚本：
```bash
python scripts/test_new_scenes.py
```

输出包含：
- 每个场景的球体数量
- 平均 FPS
- 网格显存占用
- 性能统计汇总表

### 获取场景信息

```python
from scenes.scene_configs import get_scene

spheres, materials, cam_params = get_scene('classroom')
print(f"Spheres: {len(spheres)}")
print(f"Camera: {cam_params}")
```

---

## 场景对比表

| 场景 | 球体数 | 主光源 | 材质复杂度 | 光照复杂度 | 测试重点 |
|------|--------|--------|-----------|-----------|---------|
| random | ~400 | 1个点光源 | 高 | 低 | 基础渲染 |
| cornell_box | 7 | 1个面光源 | 中 | 中 | 颜色溢出 |
| two_room | ~15 | 1个点光源 | 中 | 中 | 窄缝漏光 |
| night_scene | ~30 | 5个彩色点光源 | 中 | 高 | 多光源 |
| classroom | ~20 | 2个窗户+灯 | 中 | 中 | 环境光 |
| bathroom | ~10 | 2个暖色灯 | 高 | 中 | 镜面/caustics |
| veach_mis | ~15 | 7个多强度灯 | 高 | 高 | 重要性采样 |

---

## 场景设计原则

### 大球近似平面
由于当前项目仅支持 Sphere 几何体，所有墙壁、地板、天花板都使用 R=1000 的大球近似平面。

### 颜色选择
- **漫反射**: 使用柔和色调，避免过度饱和
- **金属**: 使用自然金属色（铜、银、金等）
- **光源**: 强度适中，避免曝光过度

### 相机设置
- **FOV**: 根据场景大小调整（35°-60°）
- **景深**: 大部分场景禁用，random 场景启用以展示散焦
- **视点**: 选择最佳观察角度

---

## 自定义场景

### 创建新场景

```python
def create_my_scene():
    """自定义场景"""
    spheres = []
    materials = []

    # 添加地面
    spheres.append(Sphere(center=vec3(0, -1000, 0), radius=1000))
    materials.append(material.Lambert(vec3(0.5, 0.5, 0.5)))

    # 添加物体
    spheres.append(Sphere(center=vec3(0, 1, 0), radius=0.5))
    materials.append(material.Metal(vec3(0.8, 0.8, 0.8), 0.0))

    # 添加光源
    spheres.append(Sphere(center=vec3(0, 5, 0), radius=0.3))
    materials.append(material.DiffuseLight(vec3(10, 10, 10)))

    # 相机参数
    cam_params = dict(
        lookfrom=vec3(0, 2, 8),
        lookat=vec3(0, 0, 0),
        vup=vec3(0, 1, 0),
        vfov=40.0,
        defocus_angle=0.0,
        focus_dist=8.0,
        scene_mode='my_scene'
    )

    return spheres, materials, cam_params

# 注册到 SCENES 字典
SCENES['my_scene'] = create_my_scene
```

---

## 常见问题

### Q: 为什么某些场景渲染很慢？
A: 场景复杂度（球体数量、材质类型）会影响性能。降低网格分辨率可提升速度。

### Q: 如何调整场景亮度？
A: 修改发光材质的强度值：
```python
material.DiffuseLight(vec3(20, 20, 20))  # 提高亮度
```

### Q: 如何添加新的几何体？
A: 当前仅支持 Sphere。如需其他几何体，需要扩展 `hittable.py`。

---

## 相关文档

- **README_INTEGRATED.md**: 项目整体文档
- **PARAMETERS_GUIDE.md**: 所有参数详细说明
- **BENCHMARK_GUIDE.md**: 基准测试指南
- **PAPER_IMPLEMENTATION_GUIDE.md**: 论文实现指南
