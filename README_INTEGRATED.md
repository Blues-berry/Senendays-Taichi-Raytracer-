# Taichi å…‰çº¿è¿½è¸ªæ¸²æŸ“å™¨ - ç»Ÿä¸€æ–‡æ¡£

åŸºäº Python å’Œ Taichi åº“æ„å»ºçš„é«˜æ€§èƒ½å…‰çº¿è¿½è¸ªæ¸²æŸ“å™¨ï¼Œæ”¯æŒå¤šç§æ¸²æŸ“æ¨¡å¼ã€å®Œæ•´çš„æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œæ•°æ®åˆ†æå·¥å…·ã€‚

![Raytracing in One Weekend Image](images/raytracing_in_one_weekend.png)

## ğŸ“š ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [æ¸²æŸ“æ¨¡å¼](#-æ¸²æŸ“æ¨¡å¼)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [ä½¿ç”¨æŒ‡å—](#-ä½¿ç”¨æŒ‡å—)
- [æ•°æ®åˆ†æ](#-æ•°æ®åˆ†æ)
- [æŒ‡ä»¤ä¸ä»»åŠ¡](#-æŒ‡ä»¤ä¸ä»»åŠ¡)
- [è®¡ç®—é€»è¾‘](#-è®¡ç®—é€»è¾‘)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
- [è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pip install taichi numpy matplotlib
```

### åŸºç¡€æ¸²æŸ“

```bash
# è¿è¡Œä¸»ç¨‹åºï¼ˆäº¤äº’å¼æ¸²æŸ“ï¼‰
python main.py
```

### æ€§èƒ½åŸºå‡†æµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´åŸºå‡†æµ‹è¯•ï¼ˆå„æ¨¡å¼600å¸§ï¼Œè‡ªåŠ¨ç”Ÿæˆåˆ†æå›¾è¡¨ï¼‰
python benchmark.py
```

### è¿è¡Œæ‰€æœ‰åœºæ™¯æµ‹è¯•

```bash
# æµ‹è¯•æ‰€æœ‰é¢„å®šä¹‰åœºæ™¯
python scripts/run_all_tests.py
```

---

## ğŸ® æ¸²æŸ“æ¨¡å¼

### 1. **Path Tracing (PT)** - è·¯å¾„è¿½è¸ª
- **æ¨¡å¼**: `0`
- **ç‰¹ç‚¹**: ç‰©ç†ç²¾ç¡®çš„å…¨å±€å…‰ç…§æ¸²æŸ“
- **é€Ÿåº¦**: æ…¢é€Ÿ (1-2 FPS)
- **è´¨é‡**: æœ€é«˜ï¼Œä½œä¸ºå‚è€ƒæ ‡å‡†
- **ç”¨é€”**: æœ€ç»ˆæ¸²æŸ“ã€è´¨é‡åŸºå‡†

### 2. **Pure Grid** - çº¯ç½‘æ ¼æ¸²æŸ“
- **æ¨¡å¼**: `1` 
- **ç‰¹ç‚¹**: åŸºäºç©ºé—´ç½‘æ ¼çš„å¿«é€Ÿæ¸²æŸ“
- **é€Ÿåº¦**: å¿«é€Ÿ (90-100 FPS å¹³å‡ï¼Œå³°å€¼å¯è¾¾ 900+ FPS)
- **è´¨é‡**: ä¸­ç­‰ï¼ŒMSE â‰ˆ 4.45e-06
- **ç”¨é€”**: å®æ—¶é¢„è§ˆã€é™æ€åœºæ™¯

### 3. **Hybrid Adaptive** - æ··åˆè‡ªé€‚åº”
- **æ¨¡å¼**: `2`
- **ç‰¹ç‚¹**: ç»“åˆç½‘æ ¼å’Œè·¯å¾„è¿½è¸ªçš„è‡ªé€‚åº”ç®—æ³•
- **é€Ÿåº¦**: ä¸­ç­‰ (70-75 FPS å¹³å‡)
- **è´¨é‡**: ä¼˜äºç½‘æ ¼ï¼ŒMSE â‰ˆ 4.45e-06
- **ç”¨é€”**: åŠ¨æ€åœºæ™¯ã€å¹³è¡¡æ€§èƒ½ä¸è´¨é‡

### æ€§èƒ½å¯¹æ¯”

| æ¨¡å¼ | å¹³å‡FPS | ç›¸å¯¹PTå€æ•° | MSE | é€‚ç”¨åœºæ™¯ |
|------|---------|-------------|-----|----------|
| Path Tracing | 1.1 | 1x (åŸºå‡†) | 0.0 | æœ€ç»ˆæ¸²æŸ“ |
| Pure Grid | 108.3 | **98.5x** | 4.45e-06 | é™æ€åœºæ™¯ |
| Hybrid | 71.9 | **65.4x** | 4.45e-06 | åŠ¨æ€åœºæ™¯ |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
Senendays-Taichi-Raytracer-
â”œâ”€â”€ ğŸ“„ æ ¸å¿ƒæ–‡ä»¶
â”‚   â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ benchmark.py           # æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆå«è‡ªåŠ¨åˆ†æï¼‰
â”‚   â”œâ”€â”€ camera.py              # ç›¸æœºä¸æ¸²æŸ“æ ¸å¿ƒ
â”‚   â”œâ”€â”€ material.py            # æè´¨ç³»ç»Ÿ
â”‚   â”œâ”€â”€ world.py               # åœºæ™¯ç®¡ç†
â”‚   â”œâ”€â”€ ray.py                # å…‰çº¿å®šä¹‰
â”‚   â”œâ”€â”€ hittable.py           # ç¢°æ’æ£€æµ‹
â”‚   â”œâ”€â”€ utils.py              # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ experiment_config.py   # å®éªŒå‚æ•°é…ç½®
â”‚
â”œâ”€â”€ ğŸ¬ åœºæ™¯é…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ scene_configs.py      # åœºæ™¯å®šä¹‰ï¼ˆcornell_box, two_room, night_scene, randomï¼‰
â”‚
â”œâ”€â”€ ğŸ§ª æµ‹è¯•ä¸åˆ†æè„šæœ¬
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ benchmark_utils.py              # åŸºå‡†æµ‹è¯•å·¥å…·
â”‚   â”œâ”€â”€ convergence_speed_benchmark.py  # æŒ‡ä»¤2: æ”¶æ•›é€Ÿåº¦ç»Ÿè®¡
â”‚   â”œâ”€â”€ error_heatmap_sequence_fast.py  # æŒ‡ä»¤4: è¯¯å·®çƒ­åŠ›å›¾åºåˆ—
â”‚   â”œâ”€â”€ grid_resolution_analyzer.py      # æŒ‡ä»¤5: ç½‘æ ¼åˆ†è¾¨ç‡åˆ†æ
â”‚   â”œâ”€â”€ memory_analysis.py              # æŒ‡ä»¤5: æ˜¾å­˜åˆ†æ
â”‚   â”œâ”€â”€ generate_heatmap.py            # çƒ­åŠ›å›¾ç”Ÿæˆ
â”‚   â”œâ”€â”€ test_scenes_simple.py         # ç®€å•åœºæ™¯æµ‹è¯•
â”‚   â””â”€â”€ run_all_tests.py             # ç»Ÿä¸€è¿è¡Œè„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“Š ç»˜å›¾å·¥å…·
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ plotting_tools.py       # åŸºç¡€ç»˜å›¾å‡½æ•°
â”‚   â”œâ”€â”€ plot_manager.py         # ç»Ÿä¸€ç»˜å›¾ç®¡ç†å™¨ï¼ˆæ¨èä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ plot_results_legacy.py  # æ—§ç‰ˆç»˜å›¾å…¼å®¹
â”‚   â””â”€â”€ plot_tradeoff_curves.py # æƒè¡¡æ›²çº¿
â”‚
â”œâ”€â”€ ğŸ“ ç»“æœè¾“å‡º
â”‚   â””â”€â”€ results/              # æ‰€æœ‰æ•°æ®ç»Ÿä¸€ä¿å­˜ç›®å½•
â”‚       â”œâ”€â”€ benchmark_results_YYYYMMDD_HHMMSS/
â”‚       â”‚   â”œâ”€â”€ benchmark_results.csv    # åŸºå‡†æµ‹è¯•æ•°æ®
â”‚       â”‚   â”œâ”€â”€ plots/                  # è‡ªåŠ¨ç”Ÿæˆçš„åˆ†æå›¾è¡¨
â”‚       â”‚   â”‚   â”œâ”€â”€ mse_over_time.png
â”‚       â”‚   â”‚   â”œâ”€â”€ detailed_mse_analysis.png
â”‚       â”‚   â”‚   â”œâ”€â”€ summary_report.txt
â”‚       â”‚   â”‚   â””â”€â”€ BENCHMARK_ANALYSIS_REPORT.md
â”‚       â”‚   â”œâ”€â”€ result_path_tracing.png   # PTç»“æœå›¾
â”‚       â”‚   â”œâ”€â”€ result_pure_grid.png      # Gridç»“æœå›¾
â”‚       â”‚   â””â”€â”€ result_hybrid.png         # Hybridç»“æœå›¾
â”‚       â”œâ”€â”€ convergence_benchmark_YYYYMMDD_HHMMSS/
â”‚       â”‚   â”œâ”€â”€ convergence_speed_scatter.png
â”‚       â”‚   â”œâ”€â”€ mse_convergence_curves.png
â”‚       â”‚   â””â”€â”€ convergence_summary.csv
â”‚       â””â”€â”€ heatmap_sequence_YYYYMMDD_HHMMSS/
â”‚           â”œâ”€â”€ ERROR_frame_*.png
â”‚           â”œâ”€â”€ COMPARISON_frame_*.png
â”‚           â”œâ”€â”€ RENDER_frame_*.png
â”‚           â””â”€â”€ heatmap_sequence_data.csv
â”‚
â”œâ”€â”€ ğŸ–¼ï¸ ç¤ºä¾‹å›¾åƒ
â”‚   â””â”€â”€ images/               # æ¸²æŸ“æ•ˆæœå±•ç¤º
â”‚
â”œâ”€â”€ ğŸ§ª æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ test/                # å•å…ƒæµ‹è¯•å’ŒéªŒè¯è„šæœ¬
â”‚
â””â”€â”€ ğŸ“„ æ–‡æ¡£æ–‡ä»¶
    â”œâ”€â”€ README.md             # æœ¬æ–‡æ¡£ï¼ˆç»Ÿä¸€ï¼‰
    â”œâ”€â”€ PROJECT_STRUCTURE.md   # é¡¹ç›®ç»“æ„è¯¦æƒ…
    â”œâ”€â”€ COMPLETED_TASKS.md   # å·²å®Œæˆä»»åŠ¡æ±‡æ€»
    â”œâ”€â”€ FPS_MSE_CALCULATION_ANALYSIS.md  # è®¡ç®—é€»è¾‘åˆ†æ
    â”œâ”€â”€ FPS_MSE_FIXES_APPLIED.md        # ä¿®å¤æ€»ç»“
    â”œâ”€â”€ PLOTS_ANALYSIS.md               # ç»˜å›¾åˆ†ææŠ¥å‘Š
    â””â”€â”€ å…¶ä»–ä¸“é¢˜æ–‡æ¡£...
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### è¿è¡ŒåŸºå‡†æµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´åŸºå‡†æµ‹è¯•
python benchmark.py

# æµ‹è¯•å®Œæˆåè‡ªåŠ¨ç”Ÿæˆåˆ†æå›¾è¡¨
# è¾“å‡ºåˆ°: results/benchmark_results_YYYYMMDD_HHMMSS/plots/
```

**è‡ªåŠ¨ç”Ÿæˆçš„å›¾è¡¨**:
- `mse_over_time.png` - MSE éšæ—¶é—´å˜åŒ–æ›²çº¿
- `detailed_mse_analysis.png` - 4å­å›¾è¯¦ç»†åˆ†æ
- `summary_report.txt` - æ–‡æœ¬æ‘˜è¦æŠ¥å‘Š
- `BENCHMARK_ANALYSIS_REPORT.md` - å®Œæ•´åˆ†ææŠ¥å‘Š

### æ‰‹åŠ¨ç”Ÿæˆåˆ†æå›¾è¡¨

```bash
# ä½¿ç”¨ç»˜å›¾ç®¡ç†å™¨ç”Ÿæˆæ‰€æœ‰å›¾è¡¨
python -c "from plots.plot_manager import generate_all_plots; generate_all_plots('results/benchmark_results_20251226_172131')"
```

### è¿è¡Œæ”¶æ•›é€Ÿåº¦åˆ†æï¼ˆæŒ‡ä»¤2ï¼‰

```bash
python scripts/convergence_speed_benchmark.py
```

**è¾“å‡º**:
- `convergence_speed_scatter.png` - æ•£ç‚¹å›¾ï¼ˆç®—åŠ›æ¶ˆè€— vs æ”¶æ•›æ—¶é—´ï¼‰
- `mse_convergence_curves.png` - MSEæ”¶æ•›æ›²çº¿å¯¹æ¯”
- `convergence_summary.csv` - æ•°æ®æ‘˜è¦

### è¿è¡Œè¯¯å·®çƒ­åŠ›å›¾åºåˆ—ï¼ˆæŒ‡ä»¤4ï¼‰

```bash
python scripts/error_heatmap_sequence_fast.py
```

**è¾“å‡º**:
- `ERROR_frame_*.png` - å„å¸§è¯¯å·®çƒ­åŠ›å›¾
- `COMPARISON_frame_*.png` - ä¸‰è”å¯¹æ¯”å›¾ï¼ˆHybrid + PT + Errorï¼‰
- `heatmap_sequence_collage.png` - çƒ­åŠ›å›¾åºåˆ—æ‹¼å›¾
- `mse_convergence.png` - MSEæ”¶æ•›æ›²çº¿

### è¿è¡Œç½‘æ ¼åˆ†è¾¨ç‡åˆ†æï¼ˆæŒ‡ä»¤5ï¼‰

```bash
python scripts/grid_resolution_analyzer.py
python scripts/memory_analysis.py
```

**è¾“å‡º**:
- `grid_resolution_performance.csv` - å„åˆ†è¾¨ç‡æ€§èƒ½æ•°æ®
- `memory_usage.csv` - æ˜¾å­˜å ç”¨æ•°æ®

### åœºæ™¯é…ç½®

æ‰€æœ‰åœºæ™¯å®šä¹‰åœ¨ `scenes/scene_configs.py` ä¸­ï¼š

| åœºæ™¯åç§° | æè¿° | ç”¨é€” |
|-----------|------|------|
| `cornell_box` | æ ‡å‡†Cornell Box | åŸºå‡†æµ‹è¯• |
| `two_room` | ä¸¤å®¤ä¸€é—¨ | å‹åŠ›æµ‹è¯•ï¼ˆçª„ç¼æ¼å…‰ï¼‰ |
| `night_scene` | å¤œé—´åœºæ™¯ | æµ‹è¯•æš—å…‰ç¯å¢ƒ |
| `random` | éšæœºå°çƒ | é»˜è®¤åœºæ™¯ |

åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼š

```python
from scenes.scene_configs import get_scene

spheres, materials, cam_params = get_scene('cornell_box')
world = World(spheres, materials)
cam = Camera(world, **cam_params)
```

---

## ğŸ“Š æ•°æ®åˆ†æ

### CSV æ•°æ®æ ¼å¼

#### åŸºå‡†æµ‹è¯•æ•°æ®

```csv
frame,mode,fps,mse,timestamp
0,Path Tracing,1.1,0.0,2025-12-26T17:21:34.626977
1,Path Tracing,1.1,0.0,2025-12-26T17:21:36.065854
...
600,Pure Grid,1.3,4.4532935e-06,2025-12-26T17:31:18.101546
```

#### æ”¶æ•›é€Ÿåº¦æ•°æ®

```csv
strategy,total_gpu_time_ms,converged_frame,final_mse
Fixed Low,15000,85,4.52e-06
Fixed High,50000,45,4.48e-06
Adaptive,18000,60,4.45e-06
```

### æ•°æ®åˆ†æå·¥å…·

#### ä½¿ç”¨ç»˜å›¾ç®¡ç†å™¨

```python
from plots.plot_manager import generate_all_plots

# ç”Ÿæˆæ‰€æœ‰åˆ†æå›¾è¡¨
generate_all_plots('results/benchmark_results_20251226_172131')
```

#### ç›´æ¥ä½¿ç”¨ç»˜å›¾å‡½æ•°

```python
from plots.plotting_tools import (
    plot_convergence_scatter,
    plot_mse_curves,
    create_heatmap_collage,
    plot_fps_comparison
)

# ç»˜åˆ¶æ”¶æ•›é€Ÿåº¦æ•£ç‚¹å›¾
plot_convergence_scatter(results, 'output_path.png', title='Convergence Speed')

# ç»˜åˆ¶MSEæ›²çº¿
plot_mse_curves(mse_data, 'output_path.png', title='MSE Convergence')
```

---

## ğŸ“‹ æŒ‡ä»¤ä¸ä»»åŠ¡

### å·²å®ŒæˆæŒ‡ä»¤ âœ…

#### æŒ‡ä»¤2ï¼šæ”¶æ•›é€Ÿåº¦ç»Ÿè®¡

**è„šæœ¬**: `scripts/convergence_speed_benchmark.py`

**æµ‹è¯•çš„3ç§ç­–ç•¥**:
1. å›ºå®šä½æ¦‚ç‡æ›´æ–° (1%)
2. å›ºå®šé«˜æ¦‚ç‡æ›´æ–° (10%)
3. è‡ªé€‚åº”æ›´æ–°é€»è¾‘ (åŸºç¡€1% + è¿åŠ¨åŒºåŸŸæå‡)

**è®ºæ–‡ç”¨é€”**:
- è¯æ˜è‡ªé€‚åº”ç®—æ³•åœ¨æ•ˆç‡æ–¹é¢çš„ä¼˜åŠ¿
- æ”¯æ’‘è®ºæ–‡ä¸­å…³äº"æ•ˆç‡æå‡"çš„æ ¸å¿ƒæ•°æ®

---

#### æŒ‡ä»¤3ï¼šä¸¤å®¤ä¸€é—¨åœºæ™¯

**å®ç°ä½ç½®**: `scenes/scene_configs.py` ä¸­çš„ `create_two_room_scene()`

**åœºæ™¯æè¿°**:
- æˆ¿é—´A (z < 0): åŒ…å«å…‰æº
- æˆ¿é—´B (z > 0): ä»…é€šè¿‡çª„ç¼æ¥å—é—´æ¥å…‰

**æµ‹è¯•ç›®æ ‡**:
1. æ·±åº¦é®æŒ¡æ£€æµ‹æ˜¯å¦èƒ½é˜»æ­¢å…‰çº¿"ç©¿å¢™"ç›´æ¥ç…§äº®æˆ¿é—´B
2. é‡‡æ ·æ˜¯å¦èƒ½å‡†ç¡®æ•æ‰ç»è¿‡é—¨ç¼å°„å…¥çš„å¾®å¼±é—´æ¥å…‰

**è®ºæ–‡ç”¨é€”**:
- è¯æ˜ç®—æ³•åœ¨å¤æ‚é®æŒ¡ä¸‹çš„è¡¨ç°
- å±•ç¤ºå¤„ç†å¤æ‚å‡ ä½•æ‹“æ‰‘æ—¶çš„ä¼˜è¶Šæ€§

---

#### æŒ‡ä»¤4ï¼šè¯¯å·®çƒ­åŠ›å›¾åºåˆ—

**è„šæœ¬**: `scripts/error_heatmap_sequence_fast.py`

**ç”Ÿæˆå†…å®¹** (é’ˆå¯¹ç‰©ä½“ç§»åŠ¨åç¬¬ 1ã€5ã€20ã€100 å¸§):
- `ERROR_frame_*.png` - Hybrid vs PT çš„å·®å€¼çƒ­åŠ›å›¾ï¼ˆä¼ªå½©è‰²ï¼šè“=ä½è¯¯å·®ï¼Œçº¢=é«˜è¯¯å·®ï¼‰
- `COMPARISON_frame_*.png` - ä¸‰è”å¯¹æ¯”å›¾ï¼ˆHybrid + PT + Errorï¼‰
- `RENDER_frame_*.png` - Hybridæ¸²æŸ“ç»“æœ

**è®ºæ–‡ç”¨é€”**:
- ç›´è§‚å±•ç¤ºç®—æ³•åœ¨çŸ­æ—¶é—´å†…å¿«é€Ÿ"æŠ¹å¹³"é«˜è¯¯å·®åŒºåŸŸçš„èƒ½åŠ›
- è¯æ˜ç®—æ³•çš„æ—¶åŸŸä¸€è‡´æ€§ï¼ˆTemporal Consistencyï¼‰

---

### å¾…å®ŒæˆæŒ‡ä»¤ ğŸ“‹

#### æŒ‡ä»¤1ï¼šè¿åŠ¨æ„ŸçŸ¥åŠ¨æ€é‡‡æ ·

**ä»»åŠ¡**: åœ¨ `camera.py` ä¸­å¢å¼ºè‡ªé€‚åº”é€»è¾‘
- ç»´æŠ¤ä¸€ä¸ª `velocity_field`ï¼Œè®°å½•åœºæ™¯ä¸­ç‰©ä½“çš„è¿åŠ¨çŸ¢é‡
- å¦‚æœæŸä¸ªç½‘æ ¼ç‚¹å¯¹åº”çš„åŒºåŸŸå†…æœ‰ç‰©ä½“å¿«é€Ÿç§»åŠ¨ï¼Œæ ¹æ®é€Ÿåº¦æŒ‰æ¯”ä¾‹æå‡ `samples_per_probe`
- åœ¨ç‰©ä½“ç§»åŠ¨çš„æ–¹å‘ä¸Šæå‰è¿›è¡Œ"é¢„é‡‡æ ·"ï¼ˆPre-samplingï¼‰

**è®ºæ–‡ä»·å€¼**: è®ºè¯ç®—æ³•å…·æœ‰æä½³çš„æ—¶åŸŸä¸€è‡´æ€§ï¼ˆTemporal Consistencyï¼‰

---

#### æŒ‡ä»¤5ï¼šç½‘æ ¼åˆ†è¾¨ç‡æƒè¡¡åˆ†æ

**ä»»åŠ¡**: ç»Ÿè®¡ä¸åŒç½‘æ ¼åˆ†è¾¨ç‡ä¸‹çš„æ€§èƒ½å¼€é”€
- æµ‹è¯•åˆ†è¾¨ç‡: $16^3, 32^3, 64^3$
- ç»Ÿè®¡æŒ‡æ ‡:
  - GPU æ˜¾å­˜å ç”¨ (MB)
  - æ¯å¸§æ›´æ–°è€—æ—¶ (ms)
  - å•ä½è®¡ç®—é‡ä¸‹çš„è¯¯å·®ä¸‹é™ç‡

**è®ºæ–‡ç”¨é€”**: æ”¯æ’‘è®ºæ–‡ä¸­å…³äº"ç®—æ³•è½»é‡åŒ–"çš„è®ºç‚¹ï¼Œè¯æ˜å…¶é€‚åˆåœ¨ç§»åŠ¨ç«¯æˆ–ä½åŠŸè€— GPU ä¸Šè¿è¡Œ

---

## ğŸ”¢ è®¡ç®—é€»è¾‘

### FPS è®¡ç®—

#### å…¬å¼
```python
frame_time = time.perf_counter() - start_time  # ç§’
fps = 1.0 / frame_time if frame_time > 1e-6 else 0.0
```

#### ç‰¹æ€§
- ä½¿ç”¨ `time.perf_counter()` æä¾›å¾®ç§’çº§ç²¾åº¦
- åŒ…å«å®Œæ•´æ¸²æŸ“æµç¨‹ï¼ˆç½‘æ ¼æ›´æ–°ã€æ¸²æŸ“ã€æ»¤æ³¢ã€è‡ªé€‚åº”æƒé‡è®¡ç®—ï¼‰
- `ti.sync()` ç¡®ä¿ GPU æ“ä½œå®Œæˆåæ‰è®¡æ—¶
- è¿‡æ»¤æç«¯å€¼ï¼ˆ< 0.1 æˆ– > 10000 FPSï¼‰

### MSE è®¡ç®—

#### å…¬å¼
```python
def calculate_accurate_mse(current_linear, reference_linear):
    # è½¬æ¢ä¸º float32
    curr_f = current_linear.astype(np.float32)
    ref_f = reference_linear.astype(np.float32)
    
    # å½’ä¸€åŒ–åˆ° [0, 1] èŒƒå›´
    if curr_f.max() > 255.0:
        curr_f = curr_f / 255.0
    if ref_f.max() > 255.0:
        ref_f = ref_f / 255.0
    
    # å¤„ç† NaN å’Œ Inf å€¼
    curr_f = np.nan_to_num(curr_f, nan=0.0, posinf=0.0, neginf=0.0)
    ref_f = np.nan_to_num(ref_f, nan=0.0, posinf=0.0, neginf=0.0)
    
    # ç¡®ä¿å€¼åœ¨åˆç†èŒƒå›´å†…
    curr_f = np.clip(curr_f, 0.0, 1.0)
    ref_f = np.clip(ref_f, 0.0, 1.0)
    
    # è®¡ç®—çº¿æ€§ç©ºé—´ MSE
    diff = curr_f - ref_f
    mse = np.mean(diff ** 2)
    return float(mse)
```

#### ç‰¹æ€§
- åœ¨çº¿æ€§ç©ºé—´è®¡ç®—ï¼Œæ›´å‡†ç¡®åæ˜ ç‰©ç†äº®åº¦å·®å¼‚
- è‡ªåŠ¨å½’ä¸€åŒ–å¤„ç†
- NaN/Inf å¼‚å¸¸å€¼ä¿æŠ¤
- æ•°æ®èŒƒå›´éªŒè¯

### å†…å­˜å ç”¨è®¡ç®—

#### ç½‘æ ¼å†…å­˜å…¬å¼
```python
grid_memory_mb = (
    grid_res[0] * grid_res[1] * grid_res[2] *  # å•å…ƒæ€»æ•°
    3 * 4 /                                      # RGB 3é€šé“ * float32 4å­—èŠ‚
    (1024.0 * 1024.0)                         # è½¬æ¢ä¸º MB
)
```

#### ç¤ºä¾‹ (64^3 ç½‘æ ¼)
```
64 * 64 * 64 = 262,144 å•å…ƒ
262,144 * 3 * 4 = 3,145,728 å­—èŠ‚
3,145,728 / (1024 * 1024) = 3.0 MB
```

---

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### ç²¾ç¡®çš„æ€§èƒ½æµ‹é‡
- **GPUåŒæ­¥**: ä½¿ç”¨ `ti.sync()` ç¡®ä¿æµ‹é‡å®é™…æ‰§è¡Œæ—¶é—´
- **é«˜ç²¾åº¦è®¡æ—¶**: `time.perf_counter()` æä¾›å¾®ç§’çº§ç²¾åº¦
- **å¼‚å¸¸å€¼è¿‡æ»¤**: è¿‡æ»¤æç«¯ FPS å€¼ï¼ˆ< 0.1 æˆ– > 10000ï¼‰
- **å®æ—¶æ•°æ®**: æ¯10å¸§è‡ªåŠ¨ä¿å­˜ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±

### æ™ºèƒ½è‡ªé€‚åº”
- **äº®åº¦æ„ŸçŸ¥**: æ ¹æ®åƒç´ äº®åº¦è‡ªé€‚åº”è°ƒæ•´é‡‡æ ·ç‡
- **è¿åŠ¨æ£€æµ‹**: åŸºäºG-bufferå˜åŒ–æ£€æµ‹ç‰©ä½“ç§»åŠ¨
- **æ–¹å·®å¼•å¯¼**: æ ¹æ®ç½‘æ ¼å•å…ƒæ–¹å·®æŒ‡å¯¼æ›´æ–°ç­–ç•¥

### è´¨é‡è¯„ä¼°
- ä»¥Path Tracingç»“æœä¸ºå‚è€ƒåŸºå‡†
- å®æ—¶è®¡ç®—å…¶ä»–æ¨¡å¼ç›¸å¯¹äºPTçš„è´¨é‡å·®å¼‚
- æ”¯æŒæ”¶æ•›åˆ†æå’Œè´¨é‡å¯¹æ¯”
- çº¿æ€§ç©ºé—´MSEè®¡ç®—ï¼Œæ›´å‡†ç¡®

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. FPSæ˜¾ç¤ºå¼‚å¸¸é«˜
- **ç°è±¡**: FPSæ˜¾ç¤º1000+
- **åŸå› **: GPUå¼‚æ­¥æ‰§è¡Œå¯¼è‡´è®¡æ—¶ä¸å‡†ç¡®
- **è§£å†³**: å·²é€šè¿‡GPUåŒæ­¥å’Œæç«¯å€¼è¿‡æ»¤ä¿®å¤

### 2. MSEå§‹ç»ˆä¸º0
- **ç°è±¡**: MSEåˆ—å…¨ä¸º0
- **åŸå› **: PTå‚è€ƒå¸§æœªæ­£ç¡®è®¾ç½®
- **è§£å†³**: å·²ä¿®å¤å‚è€ƒå¸§å­˜å‚¨å’Œè®¡ç®—é€»è¾‘

### 3. æ•°æ®ä¸¢å¤±
- **ç°è±¡**: ç¨‹åºå¼‚å¸¸é€€å‡ºåCSVæ•°æ®ä¸å®Œæ•´
- **è§£å†³**: æ¯10å¸§è‡ªåŠ¨ä¿å­˜ï¼Œå¼‚å¸¸é€€å‡ºæ—¶ä¿å­˜å‰©ä½™æ•°æ®

### 4. Font è­¦å‘Š
- **ç°è±¡**: `Font 'default' does not have a glyph for '\u2212'`
- **åŸå› **: Matplotlib è´Ÿå·å­—ä½“æ˜¾ç¤ºé—®é¢˜
- **å½±å“**: ä»…è­¦å‘Šï¼Œä¸å½±å“è¾“å‡ºå›¾è¡¨è´¨é‡
- **è§£å†³**: å¯å¿½ç•¥ï¼Œæˆ–é…ç½® matplotlib å­—ä½“

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç¡¬ä»¶ä¼˜åŒ–
- **GPU**: æ¨èNVIDIA RTXç³»åˆ—ï¼Œæ”¯æŒCUDA
- **å†…å­˜**: å»ºè®®8GBä»¥ä¸Šï¼Œç‰¹åˆ«æ˜¯å¤§åˆ†è¾¨ç‡åœºæ™¯
- **å­˜å‚¨**: SSDå¯æå‡åœºæ™¯åŠ è½½é€Ÿåº¦

### 2. å‚æ•°è°ƒä¼˜
- **åˆ†è¾¨ç‡**: é™ä½åˆ†è¾¨ç‡å¯æ˜¾è‘—æå‡FPS
- **ç½‘æ ¼åˆ†è¾¨ç‡**: è°ƒæ•´`grid_res`å¹³è¡¡ç²¾åº¦å’Œé€Ÿåº¦
- **é‡‡æ ·ç‡**: å¢åŠ é‡‡æ ·ç‡æå‡è´¨é‡ä½†é™ä½FPS

### 3. æ¨¡å¼é€‰æ‹©ç­–ç•¥
- **å¼€å‘é˜¶æ®µ**: ä½¿ç”¨Pure Gridå¿«é€Ÿé¢„è§ˆ
- **æµ‹è¯•éªŒè¯**: ä½¿ç”¨Hybridè·å¾—å¹³è¡¡çš„æ€§èƒ½å’Œè´¨é‡
- **æœ€ç»ˆæ¸²æŸ“**: ä½¿ç”¨Path Tracingè·å¾—æœ€é«˜è´¨é‡

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### ä»£ç é£æ ¼
- éµå¾ªPEP 8è§„èŒƒ
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡åå’Œå‡½æ•°å
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²

### æäº¤è§„èŒƒ
- ä¿®å¤bug: ä½¿ç”¨`fix:`å‰ç¼€
- æ–°åŠŸèƒ½: ä½¿ç”¨`feat:`å‰ç¼€
- æ€§èƒ½ä¼˜åŒ–: ä½¿ç”¨`perf:`å‰ç¼€
- æ–‡æ¡£æ›´æ–°: ä½¿ç”¨`docs:`å‰ç¼€

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

---

## ğŸ™ è‡´è°¢

- [Taichi Graphics](https://taichi-lang.org/) - é«˜æ€§èƒ½è®¡ç®—æ¡†æ¶
- [Ray Tracing in One Weekend](https://raytracing.github.io/books/RayTracingInOneWeekend.html) - å…‰çº¿è¿½è¸ªåŸºç¡€ç†è®º
- [Cornell Box](https://en.wikipedia.org/wiki/Cornell_box) - æ ‡å‡†æµ‹è¯•åœºæ™¯

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤Issue: [GitHub Issues](https://github.com/your-repo/issues)

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- `PROJECT_STRUCTURE.md` - é¡¹ç›®ç»“æ„è¯¦æƒ…
- `COMPLETED_TASKS.md` - å·²å®Œæˆä»»åŠ¡æ±‡æ€»
- `FPS_MSE_CALCULATION_ANALYSIS.md` - è®¡ç®—é€»è¾‘åˆ†æ
- `FPS_MSE_FIXES_APPLIED.md` - ä¿®å¤æ€»ç»“
- `PLOTS_ANALYSIS.md` - ç»˜å›¾åˆ†ææŠ¥å‘Š
- `PAPER_IMPLEMENTATION_GUIDE.md` - è®ºæ–‡å®ç°æŒ‡å—
- `IMPLEMENTATION_SUMMARY.md` - å®ç°æ€»ç»“
- `GRID_ANALYSIS_README.md` - ç½‘æ ¼åˆ†ææ–‡æ¡£

---

**Happy Ray Tracing! ğŸš€**
