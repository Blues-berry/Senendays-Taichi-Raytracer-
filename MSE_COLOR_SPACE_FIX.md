# MSE è‰²å½©ç©ºé—´ä¿®å¤ï¼šç²¾ç¡®çš„å…‰åº¦å­¦æ¯”è¾ƒ

## ğŸš¨ **å…³é”®é—®é¢˜ï¼šè‰²å½©ç©ºé—´æ··æ·†**

### é—®é¢˜åˆ†æ

ä½ çš„åˆ†æå®Œå…¨æ­£ç¡®ï¼åŸå§‹ä»£ç å­˜åœ¨ä¸¥é‡çš„**è‰²å½©ç©ºé—´æ··æ·†**é—®é¢˜ï¼š

```python
# é—®é¢˜ä»£ç 
# 1. å­˜å‚¨å‚è€ƒå›¾åƒï¼ˆä¼½é©¬ç©ºé—´ï¼‰
pt_reference = current_frame.to_numpy()  # å·²ç»ç»è¿‡ linear_to_gamma è½¬æ¢

# 2. å½“å‰å›¾åƒï¼ˆä¼½é©¬ç©ºé—´ï¼‰  
current_img = current_frame.to_numpy()  # ä¹Ÿæ˜¯ä¼½é©¬ç©ºé—´

# 3. é”™è¯¯åœ°åœ¨ä¼½é©¬ç©ºé—´è®¡ç®— MSE
mse = calculate_mse(pt_reference, current_img)  # âŒ é”™è¯¯ï¼
```

### ä¸ºä»€ä¹ˆè¿™æ˜¯é”™è¯¯çš„ï¼Ÿ

#### 1. å…‰åº¦å­¦åŸç†
- **çº¿æ€§ç©ºé—´**: å…‰èƒ½é‡ä¸åƒç´ å€¼æˆæ­£æ¯”å…³ç³»ï¼Œç¬¦åˆç‰©ç†è§„å¾‹
- **ä¼½é©¬ç©ºé—´**: ä¸ºæ˜¾ç¤ºè®¾å¤‡ä¼˜åŒ–çš„éçº¿æ€§ç¼–ç ï¼Œç ´åäº†èƒ½é‡æ¯”ä¾‹å…³ç³»

#### 2. æ•°å­¦è¯¯å·®
```
çº¿æ€§ç©ºé—´: èƒ½é‡ E1 = 1.0, E2 = 0.25
æ­£ç¡®å·®å¼‚: (1.0 - 0.25)Â² = 0.5625

ä¼½é©¬ç©ºé—´ (Î³=2.2): E1' = 1.0^0.45 = 1.0, E2' = 0.25^0.45 â‰ˆ 0.53
é”™è¯¯å·®å¼‚: (1.0 - 0.53)Â² â‰ˆ 0.2209  # å®Œå…¨é”™è¯¯çš„è¯¯å·®ï¼
```

#### 3. è§†è§‰æ„ŸçŸ¥åå·®
- ä¼½é©¬ç©ºé—´å‹ç¼©é«˜å…‰åŒºåŸŸï¼Œæ‰©å¤§æš—éƒ¨åŒºåŸŸ
- å¯¼è‡´ MSE ä¸èƒ½çœŸå®åæ˜ è§†è§‰å·®å¼‚

## âœ… **ä¿®å¤æ–¹æ¡ˆ**

### æ ¸å¿ƒæ€æƒ³
**å§‹ç»ˆåœ¨çº¿æ€§ç©ºé—´è®¡ç®— MSEï¼Œä»…åœ¨æ˜¾ç¤ºæ—¶åº”ç”¨ä¼½é©¬æ ¡æ­£**

### 1. åˆ†ç¦»å­˜å‚¨å‚è€ƒå›¾åƒ
```python
# ä¿®å¤å‰
pt_reference = current_frame.to_numpy()  # ä¼½é©¬ç©ºé—´

# ä¿®å¤å
pt_reference = current_frame.to_numpy()       # ä¼½é©¬ç©ºé—´ - æ˜¾ç¤ºç”¨
pt_reference_linear = cam.frame.to_numpy()   # çº¿æ€§ç©ºé—´ - MSEè®¡ç®—ç”¨
```

### 2. ç²¾ç¡®çš„ MSE è®¡ç®—å‡½æ•°
```python
def calculate_accurate_mse(current_linear, reference_linear):
    """åœ¨çº¿æ€§ç©ºé—´è®¡ç®—ç²¾ç¡®çš„ MSE"""
    # ç¡®ä¿æ•°æ®ç±»å‹æ­£ç¡®
    curr_f = current_linear.astype(np.float32)
    ref_f = reference_linear.astype(np.float32)
    
    # å½’ä¸€åŒ–åˆ° [0, 1] èŒƒå›´
    if curr_f.max() > 1.1:
        curr_f = curr_f / 255.0
    if ref_f.max() > 1.1:
        ref_f = ref_f / 255.0
    
    # çº¿æ€§ç©ºé—´ MSE è®¡ç®—
    mse = np.mean((curr_f - ref_f) ** 2)
    return float(mse)
```

### 3. ä½¿ç”¨çº¿æ€§å¸§è¿›è¡Œæ¯”è¾ƒ
```python
# ä¿®å¤å‰
current_img = current_frame.to_numpy()  # ä¼½é©¬ç©ºé—´
mse = calculate_mse(pt_reference, current_img)

# ä¿®å¤å
current_linear = cam.frame.to_numpy()    # çº¿æ€§ç©ºé—´
mse = calculate_accurate_mse(current_linear, pt_reference_linear)
```

## ğŸ“Š **é¢„æœŸæ”¹è¿›æ•ˆæœ**

### ä¿®å¤å‰çš„é—®é¢˜
- âŒ MSE å€¼ä¸å‡†ç¡®ï¼Œå°¤å…¶åœ¨æš—éƒ¨å’Œäº®éƒ¨åŒºåŸŸ
- âŒ ä¸åŒäº®åº¦åŒºåŸŸçš„è¯¯å·®æƒé‡ä¸æ­£ç¡®
- âŒ æ— æ³•çœŸå®åæ˜ å…‰ç…§èƒ½é‡çš„å‡†ç¡®æ€§
- âŒ æ¸²æŸ“ç®—æ³•ä¼˜åŒ–çš„å‚è€ƒæ•°æ®ä¸å¯é 

### ä¿®å¤åçš„ä¼˜åŠ¿
- âœ… MSE åæ˜ çœŸå®çš„å…‰èƒ½é‡å·®å¼‚
- âœ… æ‰€æœ‰äº®åº¦åŒºåŸŸçš„è¯¯å·®æƒé‡ä¸€è‡´
- âœ… ç¬¦åˆå…‰åº¦å­¦åŸç†çš„ç§‘å­¦æ¯”è¾ƒ
- âœ… ä¸ºæ¸²æŸ“ä¼˜åŒ–æä¾›å¯é çš„è´¨é‡æŒ‡æ ‡

## ğŸ§ª **éªŒè¯æ–¹æ³•**

### 1. æ•°å€¼éªŒè¯
```python
# åˆ›å»ºæµ‹è¯•å›¾åƒ
linear_img = np.array([0.25, 0.5, 0.75])  # çº¿æ€§ç©ºé—´
gamma_img = np.sqrt(linear_img)  # ç®€åŒ–çš„ä¼½é©¬è½¬æ¢

# å¯¹æ¯” MSE
mse_linear = np.mean((linear_img - linear_img * 0.9) ** 2)      # æ­£ç¡®
mse_gamma = np.mean((gamma_img - gamma_img * 0.9) ** 2)        # é”™è¯¯

print(f"çº¿æ€§ç©ºé—´ MSE: {mse_linear:.4f}")
print(f"ä¼½é©¬ç©ºé—´ MSE: {mse_gamma:.4f}")  # åº”è¯¥æ˜¾è‘—ä¸åŒ
```

### 2. è§†è§‰éªŒè¯
- ä¿å­˜çº¿æ€§ç©ºé—´å’Œä¼½é©¬ç©ºé—´çš„ MSE çƒ­å›¾
- å¯¹æ¯”è¯¯å·®åˆ†å¸ƒçš„åˆç†æ€§
- ç¡®è®¤é«˜äº®å’Œé˜´å½±åŒºåŸŸçš„è¯¯å·®æƒé‡æ­£ç¡®

### 3. ç‰©ç†éªŒè¯
```python
# éªŒè¯èƒ½é‡å®ˆæ’
energy_before = np.mean(pt_reference_linear)
energy_after = np.mean(current_linear)

# MSE åº”è¯¥åæ˜ çœŸå®çš„èƒ½é‡å·®å¼‚
print(f"å‚è€ƒèƒ½é‡: {energy_before:.4f}")
print(f"å½“å‰èƒ½é‡: {energy_after:.4f}")
print(f"MSE èƒ½é‡å·®å¼‚: {abs(energy_before - energy_after):.4f}")
```

## ğŸ”§ **å®æ–½ç»†èŠ‚**

### æ•°æ®æµå›¾
```
æ¸²æŸ“æµç¨‹:
cam.frame (çº¿æ€§ç©ºé—´) â†’ cam.render() â†’ average_frames() â†’ current_frame (ä¼½é©¬ç©ºé—´)

MSE è®¡ç®—æµç¨‹:
cam.frame (çº¿æ€§ç©ºé—´) â†’ calculate_accurate_mse() â†’ ç²¾ç¡®çš„ MSE

æ˜¾ç¤ºæµç¨‹:
current_frame (ä¼½é©¬ç©ºé—´) â†’ gui.set_image() â†’ æ­£ç¡®çš„è§†è§‰æ•ˆæœ
```

### å…³é”®æ”¹è¿›ç‚¹
1. **æ•°æ®åˆ†ç¦»**: æ˜ç¡®åŒºåˆ†çº¿æ€§ç©ºé—´å’Œä¼½é©¬ç©ºé—´çš„æ•°æ®
2. **ä¸€è‡´è®¡ç®—**: æ‰€æœ‰ MSE è®¡ç®—éƒ½åœ¨çº¿æ€§ç©ºé—´è¿›è¡Œ
3. **ç±»å‹å®‰å…¨**: ç¡®ä¿æ•°æ®ç±»å‹å’ŒèŒƒå›´çš„ä¸€è‡´æ€§
4. **å½’ä¸€åŒ–å¤„ç†**: è‡ªåŠ¨å¤„ç†ä¸åŒçš„åƒç´ å€¼èŒƒå›´

## ğŸ“ˆ **æ€§èƒ½å½±å“**

### è®¡ç®—å¼€é”€
- **é¢å¤–å†…å­˜**: å¢åŠ ä¸€ä¸ªçº¿æ€§ç©ºé—´å‚è€ƒå›¾åƒå­˜å‚¨
- **è®¡ç®—æ—¶é—´**: æ¯å¸§å¢åŠ ä¸€æ¬¡ `.to_numpy()` è°ƒç”¨
- **æ€»ä½“å½±å“**: å¾®ä¸è¶³é“ï¼Œç›¸å¯¹äºæ¸²æŸ“æ—¶é—´å¯ä»¥å¿½ç•¥

### å†…å­˜ä½¿ç”¨
```python
# åŸå§‹å†…å­˜
pt_reference: width Ã— height Ã— 3 Ã— 4 bytes â‰ˆ 13.8 MB (1200Ã—675)

# ä¿®å¤åå†…å­˜  
pt_reference: width Ã— height Ã— 3 Ã— 4 bytes â‰ˆ 13.8 MB
pt_reference_linear: width Ã— height Ã— 3 Ã— 4 bytes â‰ˆ 13.8 MB
æ€»å¢åŠ : â‰ˆ 13.8 MB (å®Œå…¨å¯æ¥å—)
```

## ğŸ¯ **åº”ç”¨ä»·å€¼**

### ç§‘å­¦ç ”ç©¶
- æä¾›å…‰åº¦å­¦ä¸Šå‡†ç¡®çš„è´¨é‡è¯„ä¼°
- æ”¯æŒæ¸²æŸ“ç®—æ³•çš„å®šé‡æ¯”è¾ƒ
- ä¸ºå­¦æœ¯è®ºæ–‡æä¾›å¯é æ•°æ®

### å·¥ç¨‹ä¼˜åŒ–
- å‡†ç¡®è¯†åˆ«æ¸²æŸ“è´¨é‡æ”¹è¿›
- æŒ‡å¯¼ç®—æ³•å‚æ•°è°ƒä¼˜
- è¯„ä¼°ä¸åŒæ¸²æŸ“ç­–ç•¥çš„ä¼˜åŠ£

### è´¨é‡æ§åˆ¶
- å»ºç«‹æ­£ç¡®çš„è´¨é‡åŸºå‡†
- ç›‘æ§å›å½’æµ‹è¯•çš„å‡†ç¡®æ€§
- ç¡®ä¿è§†è§‰è´¨é‡çš„ä¸€è‡´æ€§

---

**æ€»ç»“**: é€šè¿‡åœ¨çº¿æ€§ç©ºé—´è®¡ç®— MSEï¼Œæˆ‘ä»¬è§£å†³äº†è‰²å½©ç©ºé—´æ··æ·†å¯¼è‡´çš„è¯¯å·®è®¡ç®—ä¸å‡†ç¡®é—®é¢˜ï¼Œç°åœ¨å¯ä»¥è·å¾—çœŸæ­£ç¬¦åˆå…‰åº¦å­¦åŸç†çš„æ¸²æŸ“è´¨é‡è¯„ä¼°æ•°æ®ã€‚